<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>국가통합바이오빅데이터구축사업 참여 신청</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f0f4f8;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 16px;
            padding: 32px 24px;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
        }

        .header {
            text-align: center;
            margin-bottom: 24px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e8f0fe;
        }

        .header h1 {
            font-size: 20px;
            color: #1a3c6e;
            margin-bottom: 12px;
            line-height: 1.4;
        }

        .info-box {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 24px;
            font-size: 13px;
            color: #475569;
            line-height: 1.8;
        }

        .info-box strong { color: #1a3c6e; }

        .info-box .highlight {
            color: #2563eb;
            font-weight: 600;
        }

        .info-box .gift {
            display: block;
            margin-top: 10px;
            color: #dc2626;
            font-weight: 600;
            font-size: 14px;
        }

        /* 스텝 표시 */
        .step { display: none; }
        .step.active { display: block; }

        .step-indicator {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 24px;
        }

        .step-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #e2e8f0;
            transition: background 0.3s;
        }

        .step-dot.active { background: #2563eb; }
        .step-dot.done { background: #22c55e; }

        /* 폼 요소 */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #334155;
            margin-bottom: 8px;
        }

        .form-group label .required {
            color: #dc2626;
            margin-left: 2px;
        }

        .form-group label .optional {
            color: #94a3b8;
            font-weight: 400;
            font-size: 12px;
        }

        .form-group input, .form-group textarea {
            width: 100%;
            padding: 12px 14px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.2s;
            outline: none;
            -webkit-appearance: none;
        }

        .form-group input:focus, .form-group textarea:focus {
            border-color: #2563eb;
        }

        .form-group input.error, .form-group textarea.error {
            border-color: #dc2626;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .hint {
            font-size: 12px;
            color: #94a3b8;
            margin-top: 4px;
        }

        .error-message {
            color: #dc2626;
            font-size: 12px;
            margin-top: 6px;
            display: none;
        }

        .error-message.show { display: block; }

        /* 라디오 버튼 */
        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            padding: 12px 14px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .radio-option:hover { border-color: #93c5fd; background: #f0f7ff; }
        .radio-option.selected { border-color: #2563eb; background: #eff6ff; }

        .radio-option input[type="radio"] {
            display: none;
        }

        .radio-option .radio-circle {
            width: 22px;
            height: 22px;
            border: 2px solid #cbd5e1;
            border-radius: 50%;
            margin-right: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.2s;
        }

        .radio-option.selected .radio-circle {
            border-color: #2563eb;
            background: #2563eb;
        }

        .radio-option.selected .radio-circle::after {
            content: '\2713';
            color: white;
            font-size: 14px;
            font-weight: bold;
        }

        .radio-option span {
            font-size: 14px;
            color: #334155;
        }

        /* 버튼 */
        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.2s, transform 0.1s;
        }

        .btn:active { transform: scale(0.98); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }

        .btn-primary {
            background: #2563eb;
            color: white;
        }

        .btn-secondary {
            background: #f1f5f9;
            color: #475569;
            margin-top: 8px;
        }

        .btn-row {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .btn-row .btn { flex: 1; }

        /* 안내 박스 */
        .notice-box {
            background: #eff6ff;
            border: 1px solid #bfdbfe;
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 20px;
            font-size: 13px;
            color: #1e40af;
            line-height: 1.6;
        }

        /* 성공 화면 */
        .success-screen {
            display: none;
            text-align: center;
            padding: 40px 20px;
        }

        .success-screen .checkmark {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #22c55e 0%, #86efac 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 40px;
            color: white;
        }

        .success-screen h2 { font-size: 22px; color: #333; margin-bottom: 8px; }
        .success-screen p { font-size: 14px; color: #64748b; line-height: 1.6; }

        /* 종료 화면 */
        .end-screen {
            display: none;
            text-align: center;
            padding: 40px 20px;
        }

        .end-screen h2 { font-size: 20px; color: #64748b; margin-bottom: 8px; }
        .end-screen p { font-size: 14px; color: #94a3b8; }
    </style>
</head>
<body>
    <div class="container">
        <!-- 헤더 -->
        <div class="header" id="mainHeader">
            <h1>국가통합바이오빅데이터<br>구축사업 참여 신청</h1>
        </div>

        <!-- 사업 안내 -->
        <div class="info-box" id="infoBox">
            국가통합바이오빅데이터구축사업은 국민의 건강 데이터를 모아 질병 예방과 맞춤형 치료법 개발을 위한 국가 주도 사업입니다.<br><br>
            <strong>&#9632; 모집 대상:</strong> 만 19세 이상의 한국인으로, 전북대학교병원에서 건강검진 예정인 자<br>
            <strong>&#9632; 수집 항목:</strong> 참여자의 혈액, 소변, 개인정보(임상정보, 공공기관 보유 데이터 등)<br>
            <strong>&#9632; 참여 방법:</strong> 신청 후 아래 참여 절차에 따라 기관 방문<br>
            <strong>&#9632; 참여 문의:</strong> <span class="highlight">063-259-3546~9</span><br>
            <strong>&#9632; 모집 장소:</strong><br>
            &nbsp;&nbsp;- (건강검진 전) 전북대학교병원 암센터 1층 건강검진센터<br>
            &nbsp;&nbsp;- (건강검진 완료 후) 전북대학교병원 임상연구지원센터 5층<br><br>
            작은 참여가 대한민국 의료 발전에 큰 힘이 됩니다.
            <span class="gift">* 참여 시 소정의 상품권이 제공됩니다.</span>
        </div>

        <!-- 스텝 인디케이터 -->
        <div class="step-indicator" id="stepIndicator">
            <div class="step-dot active" id="dot1"></div>
            <div class="step-dot" id="dot2"></div>
            <div class="step-dot" id="dot3"></div>
        </div>

        <!-- ========== STEP 1: 참여 의사 & 건강검진 여부 ========== -->
        <div class="step active" id="step1">
            <div class="form-group">
                <label>국가통합바이오빅데이터구축사업에 참여 하시겠습니까?<span class="required">*</span></label>
                <p class="hint" style="margin-bottom:8px;">※ "참여합니다" 또는 "설명을 들은 뒤 결정하겠습니다"를 선택하신 경우, 제공하신 연락처는 향후 설명 안내 및 참여 여부 확인 등을 위한 문자 발송 등에 활용될 수 있습니다.</p>
                <div class="radio-group" id="participateGroup">
                    <label class="radio-option">
                        <input type="radio" name="participate" value="참여합니다">
                        <div class="radio-circle"></div>
                        <span>참여합니다.</span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="participate" value="참여하지 않습니다">
                        <div class="radio-circle"></div>
                        <span>참여하지 않습니다.</span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="participate" value="설명을 들은 뒤 결정하겠습니다">
                        <div class="radio-circle"></div>
                        <span>설명을 들은 뒤 결정하겠습니다.</span>
                    </label>
                </div>
                <div class="error-message" id="participateError">선택해주세요</div>
            </div>

            <div class="form-group">
                <label>최근 전북대학교병원에서 국가건강검진을 받은 적이 있으신가요?<span class="required">*</span></label>
                <div class="radio-group" id="checkupGroup">
                    <label class="radio-option">
                        <input type="radio" name="checkup" value="예">
                        <div class="radio-circle"></div>
                        <span>예, 이미 건강검진을 받았습니다.</span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="checkup" value="아니요">
                        <div class="radio-circle"></div>
                        <span>아니요, 아직 건강검진을 받지 않았습니다.</span>
                    </label>
                </div>
                <div class="error-message" id="checkupError">선택해주세요</div>
            </div>

            <button type="button" class="btn btn-primary" onclick="goToStep2()">다음</button>
        </div>

        <!-- ========== STEP 2: 조건부 안내 + 참여 확인 ========== -->
        <div class="step" id="step2">
            <!-- 건강검진 아직 안 받은 경우 -->
            <div id="notYetNotice" style="display:none;">
                <div class="notice-box">
                    <strong>[건강검진을 아직 안 받은 경우]</strong><br><br>
                    건강검진 예약을 진행하신 후, 검진 당일 본 사업 참여(채혈 포함)가 가능합니다.<br>
                    (방문이 어려울 경우 참여가 어렵습니다.)<br><br>
                    &#128205; <strong>건강검진 장소:</strong> 전북대학교병원 암센터 1층<br>
                    &nbsp;&nbsp;&nbsp;건강검진센터 (운영시간: 평일 08:00~17:00)<br><br>
                    - 건강검진 예약 문의 전화: 063-250-1882, 1883, 2884<br>
                    - 건강검진 인터넷 예약: https://www.jbuh.co.kr/nhic.do
                </div>

                <div class="form-group">
                    <label>예약 후 참여하시겠습니까?<span class="required">*</span></label>
                    <div class="radio-group" id="willParticipateGroup">
                        <label class="radio-option">
                            <input type="radio" name="willParticipate" value="네, 예약 후 참여하겠습니다">
                            <div class="radio-circle"></div>
                            <span>네, 예약 후 참여하겠습니다.</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="willParticipate" value="아니요, 참여가 어렵습니다">
                            <div class="radio-circle"></div>
                            <span>아니요, 참여가 어렵습니다.</span>
                        </label>
                    </div>
                    <div class="error-message" id="willParticipateError">선택해주세요</div>
                </div>
            </div>

            <!-- 날짜 입력 (안 받은 경우: 건강검진 예정일 / 받은 경우: 희망 방문일) -->
            <div class="form-group" id="dateGroup">
                <label id="dateLabel">날짜를 입력해주세요.<span class="required">*</span></label>
                <p class="hint" id="dateHint">※ yyyymmdd 형식으로 숫자만 입력해주세요. (예: 20250101)</p>
                <input type="text" id="visitDate" placeholder="20250101" maxlength="8">
                <div class="error-message" id="dateError"></div>
            </div>

            <div class="btn-row">
                <button type="button" class="btn btn-secondary" onclick="goBack(1)">이전</button>
                <button type="button" class="btn btn-primary" onclick="goToStep3()">다음</button>
            </div>
        </div>

        <!-- ========== STEP 3: 개인정보 입력 ========== -->
        <div class="step" id="step3">
            <div class="form-group">
                <label>성함을 작성해주세요.<span class="required">*</span></label>
                <input type="text" id="name" placeholder="성함을 입력해주세요" maxlength="20">
                <div class="error-message" id="nameError"></div>
            </div>

            <div class="form-group">
                <label>휴대폰 번호를 입력해주세요.<span class="required">*</span></label>
                <input type="tel" id="phone" placeholder="01012345678" maxlength="11">
                <p class="hint">※ 숫자만 입력해주세요. (예: 01012349876)</p>
                <div class="error-message" id="phoneError"></div>
            </div>

            <div class="form-group">
                <label>생년월일을 입력해주세요.<span class="required">*</span></label>
                <input type="text" id="birthDate" placeholder="19770707" maxlength="8">
                <p class="hint">※ yyyymmdd 형식으로 숫자만 입력해주세요. (예: 20250101)</p>
                <div class="error-message" id="birthError"></div>
            </div>

            <div class="form-group">
                <label>이메일 주소를 입력해주세요. <span class="optional">(선택)</span></label>
                <input type="email" id="email" placeholder="example@email.com">
            </div>

            <div class="form-group">
                <label>의견이나 문의사항이 있으신가요? <span class="optional">(선택)</span></label>
                <textarea id="comment" placeholder="자유롭게 작성해주세요"></textarea>
            </div>

            <div class="btn-row">
                <button type="button" class="btn btn-secondary" onclick="goBack(2)">이전</button>
                <button type="button" class="btn btn-primary" id="submitBtn" onclick="handleSubmit()">제출</button>
            </div>
        </div>

        <!-- 성공 화면 -->
        <div class="success-screen" id="successScreen">
            <div class="checkmark">&#10003;</div>
            <h2>신청 완료!</h2>
            <p>참여해주셔서 감사합니다.<br>추후 안내 문자를 발송해드리겠습니다.</p>
        </div>

        <!-- 참여 안 함 종료 화면 -->
        <div class="end-screen" id="endScreen">
            <h2>감사합니다</h2>
            <p>다음 기회에 참여 부탁드립니다.</p>
        </div>
    </div>

    <script>
    const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwm6I8Hyuc0no0nQYrUirZGxCpSskLE1zFcJzKF1uz16p1PYos1VsksAdlwI4ySPuDQ/exec';

    // 상태
    let checkupStatus = '';  // '예' or '아니요'

    // ============================================================
    // 라디오 선택 시 스타일
    // ============================================================
    document.querySelectorAll('.radio-option').forEach(option => {
        const radio = option.querySelector('input[type="radio"]');
        radio.addEventListener('change', () => {
            option.closest('.radio-group').querySelectorAll('.radio-option').forEach(o => o.classList.remove('selected'));
            option.classList.add('selected');
        });
    });

    // ============================================================
    // 스텝 이동
    // ============================================================
    function showStep(n) {
        document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
        document.getElementById('step' + n).classList.add('active');
        for (let i = 1; i <= 3; i++) {
            const dot = document.getElementById('dot' + i);
            dot.classList.remove('active', 'done');
            if (i < n) dot.classList.add('done');
            if (i === n) dot.classList.add('active');
        }
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function goBack(step) { showStep(step); }

    // ============================================================
    // STEP 1 → STEP 2
    // ============================================================
    function goToStep2() {
        const participate = document.querySelector('input[name="participate"]:checked');
        const checkup = document.querySelector('input[name="checkup"]:checked');

        // 검증
        document.getElementById('participateError').classList.toggle('show', !participate);
        document.getElementById('checkupError').classList.toggle('show', !checkup);
        if (!participate || !checkup) return;

        // 참여 안 함 → 종료
        if (participate.value === '참여하지 않습니다') {
            document.getElementById('mainHeader').style.display = 'none';
            document.getElementById('infoBox').style.display = 'none';
            document.getElementById('stepIndicator').style.display = 'none';
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById('endScreen').style.display = 'block';
            return;
        }

        checkupStatus = checkup.value;

        if (checkupStatus === '아니요') {
            // 건강검진 안 받은 경우
            document.getElementById('notYetNotice').style.display = 'block';
            document.getElementById('dateLabel').textContent = '건강검진 예정일을 입력해주세요.';
            document.getElementById('dateLabel').innerHTML = '건강검진 예정일을 입력해주세요.<span class="required">*</span>';
            document.getElementById('dateHint').innerHTML = '※ yyyymmdd 형식으로 숫자만 입력해주세요. (예: 20250101)<br>(예약이 확정되지 않은 경우, 예상 날짜를 입력해주세요. 추후 예약 변경이 가능합니다.)';
            document.getElementById('dateGroup').style.display = 'none';
        } else {
            // 건강검진 받은 경우
            document.getElementById('notYetNotice').style.display = 'none';
            document.getElementById('dateLabel').innerHTML = '희망 방문일을 입력해주세요.<span class="required">*</span>';
            document.getElementById('dateHint').textContent = '※ yyyymmdd 형식으로 숫자만 입력해주세요. (예: 20250101)';
            document.getElementById('dateGroup').style.display = 'block';
        }

        showStep(2);
    }

    // ============================================================
    // STEP 2 → STEP 3
    // ============================================================
    function goToStep3() {
        if (checkupStatus === '아니요') {
            const willP = document.querySelector('input[name="willParticipate"]:checked');
            document.getElementById('willParticipateError').classList.toggle('show', !willP);
            if (!willP) return;

            if (willP.value === '아니요, 참여가 어렵습니다') {
                document.getElementById('mainHeader').style.display = 'none';
                document.getElementById('infoBox').style.display = 'none';
                document.getElementById('stepIndicator').style.display = 'none';
                document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
                document.getElementById('endScreen').style.display = 'block';
                return;
            }

            // 참여하겠다 → 날짜 입력 표시
            document.getElementById('dateGroup').style.display = 'block';
        }

        // 날짜 검증 (오늘 이후 날짜만 허용)
        const dateVal = document.getElementById('visitDate').value.trim();
        const dateResult = validateFutureDate(dateVal);
        if (!dateResult.valid) {
            document.getElementById('visitDate').classList.add('error');
            document.getElementById('dateError').textContent = dateResult.message;
            document.getElementById('dateError').classList.add('show');
            return;
        }
        document.getElementById('visitDate').classList.remove('error');
        document.getElementById('dateError').classList.remove('show');

        showStep(3);
    }

    // ============================================================
    // 날짜 검증
    // ============================================================
    function validateDate(val) {
        if (!/^\d{8}$/.test(val)) return false;
        const y = parseInt(val.substring(0, 4));
        const m = parseInt(val.substring(4, 6));
        const d = parseInt(val.substring(6, 8));
        if (y < 1900 || y > 2100) return false;
        if (m < 1 || m > 12) return false;
        if (d < 1 || d > 31) return false;
        return true;
    }

    // 방문 예정일: 오늘 이후 날짜만 허용
    function validateFutureDate(val) {
        if (!validateDate(val)) return { valid: false, message: 'yyyymmdd 형식으로 올바른 날짜를 입력해주세요' };
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        const y = parseInt(val.substring(0, 4));
        const m = parseInt(val.substring(4, 6)) - 1;
        const d = parseInt(val.substring(6, 8));
        const inputDate = new Date(y, m, d);
        if (inputDate < today) return { valid: false, message: '오늘 이후 날짜를 입력해주세요' };
        return { valid: true };
    }

    // 생년월일: 만 19세 이상만 허용
    function validateBirthDate(val) {
        if (!validateDate(val)) return { valid: false, message: 'yyyymmdd 형식으로 올바른 생년월일을 입력해주세요' };
        const today = new Date();
        const y = parseInt(val.substring(0, 4));
        const m = parseInt(val.substring(4, 6)) - 1;
        const d = parseInt(val.substring(6, 8));
        const birth = new Date(y, m, d);
        if (birth > today) return { valid: false, message: '올바른 생년월일을 입력해주세요' };
        let age = today.getFullYear() - birth.getFullYear();
        const mDiff = today.getMonth() - birth.getMonth();
        if (mDiff < 0 || (mDiff === 0 && today.getDate() < birth.getDate())) age--;
        if (age < 19) return { valid: false, message: '만 19세 이상만 참여 가능합니다' };
        return { valid: true };
    }

    // ============================================================
    // 전화번호 검증
    // ============================================================
    const PHONE_BLACKLIST = [
        '01000000000','01011111111','01012345678','01022222222','01033333333',
        '01044444444','01055555555','01066666666','01077777777','01088888888',
        '01099999999','01087654321','01011112222','01098765432','01000001111',
        '01010101010','01001010101',
    ];

    function validatePhone(phone) {
        const cleaned = phone.replace(/[-\s]/g, '');
        if (!/^01[016789]\d{7,8}$/.test(cleaned))
            return { valid: false, message: '올바른 전화번호 형식이 아닙니다' };
        if (PHONE_BLACKLIST.includes(cleaned))
            return { valid: false, message: '유효하지 않은 전화번호입니다. 본인 번호를 입력해주세요' };
        const last = cleaned.slice(3);
        if (/^(\d)\1+$/.test(last))
            return { valid: false, message: '유효하지 않은 전화번호입니다. 본인 번호를 입력해주세요' };
        if ('0123456789'.includes(last) || '9876543210'.includes(last))
            return { valid: false, message: '유효하지 않은 전화번호입니다. 본인 번호를 입력해주세요' };
        if (last.length === 8 && last.slice(0, 4) === last.slice(4))
            return { valid: false, message: '유효하지 않은 전화번호입니다. 본인 번호를 입력해주세요' };
        if (new Set(last.split('')).size <= 1)
            return { valid: false, message: '유효하지 않은 전화번호입니다. 본인 번호를 입력해주세요' };
        return { valid: true };
    }

    // ============================================================
    // 이름 검증
    // ============================================================
    const NAME_BLACKLIST = [
        '홍길동','테스트','김철수','이영희','test','ㅋㅋㅋ',
        'ㅎㅎㅎ','ㅇㅇㅇ','ㄱㄱㄱ','가나다','abc','aaa',
        '없음','몰라','비밀','익명','신청자',
    ];

    function validateName(name) {
        const t = name.trim();
        if (t.length < 2) return { valid: false, message: '이름은 2자 이상 입력해주세요' };
        if (NAME_BLACKLIST.includes(t.toLowerCase())) return { valid: false, message: '실명을 입력해주세요' };
        if (/^(.)\1+$/.test(t)) return { valid: false, message: '실명을 입력해주세요' };
        if (/^[ㄱ-ㅎㅏ-ㅣ]+$/.test(t)) return { valid: false, message: '실명을 입력해주세요' };
        return { valid: true };
    }

    // ============================================================
    // 제출
    // ============================================================
    async function handleSubmit() {
        let hasError = false;

        // 이름
        const nameInput = document.getElementById('name');
        const nameResult = validateName(nameInput.value);
        if (!nameResult.valid) {
            nameInput.classList.add('error');
            document.getElementById('nameError').textContent = nameResult.message;
            document.getElementById('nameError').classList.add('show');
            if (!hasError) { nameInput.focus(); hasError = true; }
        } else {
            nameInput.classList.remove('error');
            document.getElementById('nameError').classList.remove('show');
        }

        // 전화번호
        const phoneInput = document.getElementById('phone');
        const phoneResult = validatePhone(phoneInput.value);
        if (!phoneResult.valid) {
            phoneInput.classList.add('error');
            document.getElementById('phoneError').textContent = phoneResult.message;
            document.getElementById('phoneError').classList.add('show');
            if (!hasError) { phoneInput.focus(); hasError = true; }
        } else {
            phoneInput.classList.remove('error');
            document.getElementById('phoneError').classList.remove('show');
        }

        // 생년월일 (만 19세 이상만)
        const birthInput = document.getElementById('birthDate');
        const birthResult = validateBirthDate(birthInput.value.trim());
        if (!birthResult.valid) {
            birthInput.classList.add('error');
            document.getElementById('birthError').textContent = birthResult.message;
            document.getElementById('birthError').classList.add('show');
            if (!hasError) { birthInput.focus(); hasError = true; }
        } else {
            birthInput.classList.remove('error');
            document.getElementById('birthError').classList.remove('show');
        }

        if (hasError) return;

        // 중복 제출 방지
        const cleanedPhone = phoneInput.value.replace(/[-\s]/g, '');
        const submitted = JSON.parse(localStorage.getItem('submitted_phones') || '[]');
        if (submitted.includes(cleanedPhone)) {
            phoneInput.classList.add('error');
            document.getElementById('phoneError').textContent = '이미 신청하셨습니다';
            document.getElementById('phoneError').classList.add('show');
            return;
        }

        // 전송
        const submitBtn = document.getElementById('submitBtn');
        submitBtn.disabled = true;
        submitBtn.textContent = '전송 중...';

        const participate = document.querySelector('input[name="participate"]:checked').value;
        const checkup = document.querySelector('input[name="checkup"]:checked').value;

        try {
            await fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    participate: participate,
                    checkup: checkup === '예' ? '예, 이미 건강검진을 받았습니다' : '아니요, 아직 건강검진을 받지 않았습니다',
                    visitDate: document.getElementById('visitDate').value.trim(),
                    name: nameInput.value.trim(),
                    phone: cleanedPhone,
                    birthDate: birthInput.value.trim(),
                    email: document.getElementById('email').value.trim(),
                    comment: document.getElementById('comment').value.trim(),
                    timestamp: new Date().toLocaleString('ko-KR'),
                }),
            });

            submitted.push(cleanedPhone);
            localStorage.setItem('submitted_phones', JSON.stringify(submitted));

            document.getElementById('mainHeader').style.display = 'none';
            document.getElementById('infoBox').style.display = 'none';
            document.getElementById('stepIndicator').style.display = 'none';
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById('successScreen').style.display = 'block';

        } catch (error) {
            alert('전송에 실패했습니다. 다시 시도해주세요.');
            submitBtn.disabled = false;
            submitBtn.textContent = '제출';
        }
    }

    // 숫자만 입력 허용
    ['phone', 'visitDate', 'birthDate'].forEach(id => {
        document.getElementById(id).addEventListener('input', function() {
            this.value = this.value.replace(/[^0-9]/g, '');
        });
    });
    </script>
</body>
</html>
